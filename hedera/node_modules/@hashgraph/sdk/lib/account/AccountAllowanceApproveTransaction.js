import o,{TRANSACTION_REGISTRY as r}from"../transaction/Transaction.js";import t from"./AccountId.js";import e from"../contract/ContractId.js";import n from"../token/TokenId.js";import s from"../token/NftId.js";import a from"long";import l from"../Hbar.js";import p from"./HbarAllowance.js";import i from"./TokenAllowance.js";import f from"./TokenNftAllowance.js";class c extends o{constructor(o={}){super(),this._hbarApprovals=null!=o.hbarApprovals?o.hbarApprovals:[],this._tokenApprovals=null!=o.tokenApprovals?o.tokenApprovals:[],this._nftApprovals=null!=o.nftApprovals?o.nftApprovals:[]}static _fromProtobuf(r,t,e,n,s){const a=s[0].cryptoApproveAllowance;return o._fromProtobufTransactions(new c({hbarApprovals:(null!=a.cryptoAllowances?a.cryptoAllowances:[]).map((o=>p._fromProtobuf(o))),tokenApprovals:(null!=a.tokenAllowances?a.tokenAllowances:[]).map((o=>i._fromProtobuf(o))),nftApprovals:(null!=a.nftAllowances?a.nftAllowances:[]).map((o=>f._fromProtobuf(o)))}),r,t,e,n,s)}get hbarApprovals(){return this._hbarApprovals}approveHbarAllowance(o,r,n){return this._requireNotFrozen(),this._hbarApprovals.push(new p({spenderAccountId:"string"==typeof r?t.fromString(r):r instanceof e?t.fromEvmAddress(r.shard,r.realm,r.toSolidityAddress()):r,ownerAccountId:"string"==typeof o?t.fromString(o):o instanceof e?t.fromEvmAddress(o.shard,o.realm,o.toSolidityAddress()):o,amount:n instanceof l?n:new l(n)})),this}addHbarAllowance(o,r){return this._requireNotFrozen(),this._hbarApprovals.push(new p({spenderAccountId:"string"==typeof o?t.fromString(o):o,amount:r instanceof l?r:new l(r),ownerAccountId:null})),this}get tokenApprovals(){return this._tokenApprovals}approveTokenAllowance(o,r,s,l){return this._requireNotFrozen(),this._tokenApprovals.push(new i({tokenId:"string"==typeof o?n.fromString(o):o,spenderAccountId:"string"==typeof s?t.fromString(s):s instanceof e?t.fromEvmAddress(s.shard,s.realm,s.toSolidityAddress()):s,ownerAccountId:"string"==typeof r?t.fromString(r):r instanceof e?t.fromEvmAddress(r.shard,r.realm,r.toSolidityAddress()):r,amount:"number"==typeof l?a.fromNumber(l):l})),this}addTokenAllowance(o,r,e){return this._requireNotFrozen(),this._tokenApprovals.push(new i({tokenId:"string"==typeof o?n.fromString(o):o,spenderAccountId:"string"==typeof r?t.fromString(r):r,amount:"number"==typeof e?a.fromNumber(e):e,ownerAccountId:null})),this}addTokenNftAllowance(o,r){return this._approveTokenNftAllowance(o,null,r,null)}get tokenNftApprovals(){return this._nftApprovals}_approveTokenNftAllowance(o,r,n,a){this._requireNotFrozen();const l="string"==typeof o?s.fromString(o):o,p="string"==typeof n?t.fromString(n):n instanceof e?t.fromEvmAddress(n.shard,n.realm,n.toSolidityAddress()):n;let i=!1;for(const o of this._nftApprovals)if(0===o.tokenId.compare(l.tokenId)&&null!=o.spenderAccountId&&0===o.spenderAccountId.compare(p)){null!=o.serialNumbers&&o.serialNumbers.push(l.serial),i=!0;break}return i||this._nftApprovals.push(new f({tokenId:l.tokenId,spenderAccountId:p,ownerAccountId:"string"==typeof r?t.fromString(r):r instanceof e?t.fromEvmAddress(r.shard,r.realm,r.toSolidityAddress()):r,serialNumbers:[l.serial],allSerials:!1,delegatingSpender:"string"==typeof a?t.fromString(a):a})),this}approveTokenNftAllowance(o,r,t){return this._approveTokenNftAllowance(o,r,t,null)}approveTokenNftAllowanceWithDelegatingSpender(o,r,t,e){return this._approveTokenNftAllowance(o,r,t,e)}_approveAllTokenNftAllowance(o,r,s,a){return this._requireNotFrozen(),this._nftApprovals.push(new f({tokenId:"string"==typeof o?n.fromString(o):o,spenderAccountId:"string"==typeof s?t.fromString(s):s instanceof e?t.fromEvmAddress(s.shard,s.realm,s.toSolidityAddress()):s,ownerAccountId:"string"==typeof r?t.fromString(r):r instanceof e?t.fromEvmAddress(r.shard,r.realm,r.toSolidityAddress()):r,serialNumbers:null,allSerials:a,delegatingSpender:null})),this}addAllTokenNftAllowance(o,r,t){return this._approveAllTokenNftAllowance(o,r,t,!0)}approveTokenNftAllowanceAllSerials(o,r,t){return this._approveAllTokenNftAllowance(o,r,t,!0)}deleteTokenNftAllowanceAllSerials(o,r,t){return this._approveAllTokenNftAllowance(o,r,t,!1)}_validateChecksums(o){this._hbarApprovals.map((r=>r._validateChecksums(o))),this._tokenApprovals.map((r=>r._validateChecksums(o))),this._nftApprovals.map((r=>r._validateChecksums(o)))}_execute(o,r){return o.crypto.approveAllowances(r)}_getTransactionDataCase(){return"cryptoApproveAllowance"}_makeTransactionData(){return{cryptoAllowances:this._hbarApprovals.map((o=>o._toProtobuf())),tokenAllowances:this._tokenApprovals.map((o=>o._toProtobuf())),nftAllowances:this._nftApprovals.map((o=>o._toProtobuf()))}}_getLogId(){return`AccountAllowanceApproveTransaction:${this._transactionIds.current.validStart.toString()}`}}r.set("cryptoApproveAllowance",c._fromProtobuf);export{c as default};
//# sourceMappingURL=AccountAllowanceApproveTransaction.js.map
